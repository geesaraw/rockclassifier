<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rock Type Filter</title>
</head>
<body>
    <h1>Rock Type Filter by Minerals</h1>

    <label for="minerals">Select Minerals:</label>
    <select id="minerals" multiple size="10"></select>

    <label for="rockType">Possible Rock Types:</label>
    <select id="rockType" size="10"></select>

    <script>
        const csvFile = 'rockdat.csv';
        let rockData = [];
        const mineralsDropdown = document.getElementById('minerals');
        const rockTypeDropdown = document.getElementById('rockType');

        // Load CSV and populate minerals dropdown
        fetch(csvFile)
            .then(response => response.text())
            .then(data => {
                rockData = parseCSV(data);
                console.log("Parsed rock data:", rockData); // Debugging output
                populateMineralsDropdown();
            });

        // Parse CSV data into JSON format
        function parseCSV(data) {
            const lines = data.trim().split('\n');
            const headers = lines[0].split(',');
            return lines.slice(1).map(line => {
                const values = line.split(',').map(value => value.trim().toLowerCase());
                return {
                    RockType: values[0],
                    Minerals: values.slice(1)
                };
            });
        }

        // Populate minerals dropdown
        function populateMineralsDropdown() {
            const uniqueMinerals = new Set();
            rockData.forEach(rock => rock.Minerals.forEach(mineral => uniqueMinerals.add(mineral)));
            Array.from(uniqueMinerals).sort().forEach(mineral => {
                const option = document.createElement('option');
                option.value = mineral;
                option.textContent = mineral.charAt(0).toUpperCase() + mineral.slice(1);
                mineralsDropdown.appendChild(option);
            });
        }

        // Filter rock types based on selected minerals
        mineralsDropdown.addEventListener('change', () => {
            const selectedMinerals = Array.from(mineralsDropdown.selectedOptions).map(option => option.value);
            console.log("Selected minerals:", selectedMinerals); // Debugging output
            rockTypeDropdown.innerHTML = '';
            rockData.filter(rock => selectedMinerals.every(min => rock.Minerals.includes(min.toLowerCase())))
                .forEach(rock => {
                    const option = document.createElement('option');
                    option.value = rock.RockType;
                    option.textContent = rock.RockType;
                    rockTypeDropdown.appendChild(option);
                });
        });
    </script>
</body>
</html>
